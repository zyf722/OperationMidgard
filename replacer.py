# coding=utf-8

# Expression Replacer
# One part of the Operation Miðgarðr

import os
import codecs
import shutil

# Original script path, where all unedited script locates
SCRIPT_PATH = "D:/Tools/SteinsGateZeroPatch/Subject/original_script"

# Initialization
if os.path.exists("script"):
    shutil.rmtree("script")

shutil.copytree(SCRIPT_PATH,os.getcwd()+"\\script")
os.chdir("script")

# Get .scx file list
path = os.path.abspath('.')
filelist = os.listdir(path)
filename = []
for files in filelist:
    if os.path.isdir(os.path.join(path, files)):
        continue;
    filetype = os.path.splitext(files)[1]
    filename.append(os.path.splitext(files)[0]+filetype)
    if filetype != ".scx":
        filename.pop()
        continue;

# Replace
for file in filename:
    print("[+] Current File: "+file)
    f=open(file,"rb")
    s=f.read()
    f.close()
    
    if (file=="SG0_01_01.scx"):
        # Kurisu
        s=s.replace(b"\x00\x13\xA9\x6E\x00\x00\x10\x05\x00\xA0\x10\x00\x00\xC5\x72\x00\x00\x00\x10\x0B",b"\x00\x13\xA9\x6E\x00\x00\x10\x05\x00\xA0\x10\x00\x00\xC1\x72\x00\x00\x00\x10\x0B")
        s=s.replace(b"\x10\x05\x00\xA0\x10\x00\x00\xC5\x72\x00\x00\x00\x10\x0B",b"\x10\x05\x00\xA0\x10\x00\x00\xC6\x72\x00\x00\x00\x10\x0B")
        s=s.replace(b"\x10\x05\x00\xA0\x10\x00\x00\xCA\x72\x00\x00\x00\x10\x0B",b"\x10\x05\x00\xA0\x10\x00\x00\xC6\x72\x00\x00\x00\x10\x0B")
        s=s.replace(b"\x00\x80\x00\x00\xAC\x01\x01\x0D\x00\x00\x13\xA9\x6E\x00\x00\x10\x05\x00\xA0\x10\x00\x00\xC6\x72\x00\x00\x00\x10\x0B",b"\x00\x80\x00\x00\xAC\x01\x01\x0D\x00\x00\x13\xA9\x6E\x00\x00\x10\x05\x00\xA0\x10\x00\x00\xC1\x72\x00\x00\x00\x10\x0B")
        s=s.replace(b"\x10\x05\x00\xA0\x10\x00\x00\xC6\x74\x00\x00\x00\x10\x0B",b"\x10\x05\x00\xA0\x10\x00\x00\xC6\x72\x00\x00\x00\x10\x0B")
    elif (file=="SG0_01_02.scx"):
        # Kurisu
        s=s.replace(b"\x10\x05\x00\xA0\x10\x00\x00\xCA\x78\x00\x00\x00\x10\x0B",b"\x10\x05\x00\xA0\x10\x00\x00\xC9\x78\x00\x00\x00\x10\x0B")
        s=s.replace(b"\x10\x05\x00\xA0\x10\x00\x00\xCB\x78\x00\x00\x00\x10\x0B",b"\x10\x05\x00\xA0\x10\x00\x00\xC6\x7A\x00\x00\x00\x10\x0B")
        s=s.replace(b"\x10\x05\x00\xA0\x10\x00\x00\xC3\x74\x00\x00\x00\x10\x0B",b"\x10\x05\x00\xA0\x10\x00\x00\xC6\x74\x00\x00\x00\x10\x0B")
    elif (file=="SG0_01_04.scx"):
        # Daru
        s=s.replace(b"\x10\x05\x00\xA0\x10\x00\x00\xCA\xA6\x00\x00\x00\x10\x0B",b"\x10\x05\x00\xA0\x10\x00\x00\xC3\xA6\x00\x00\x00\x10\x0B")
        s=s.replace(b"\x10\x05\x00\xA0\x10\x00\x00\xCA\x9E\x00\x00\x00\x10\x0B",b"\x10\x05\x00\xA0\x10\x00\x00\xC6\x9E\x00\x00\x00\x10\x0B")
        s=s.replace(b"\x10\x05\x00\xA0\x10\x00\x00\xC8\xAA\x00\x00\x00\x10\x0B",b"\x10\x05\x00\xA0\x10\x00\x00\xC6\x9E\x00\x00\x00\x10\x0B")
        s=s.replace(b"\x10\x05\x00\xA0\x10\x00\x00\xC1\xA8\x00\x00\x00\x10\x0B",b"\x10\x05\x00\xA0\x10\x00\x00\xC3\xA6\x00\x00\x00\x10\x0B")
        s=s.replace(b"\x10\x05\x00\xA0\x10\x00\x00\xC3\xA8\x00\x00\x00\x10\x0B",b"\x10\x05\x00\xA0\x10\x00\x00\xC3\xA6\x00\x00\x00\x10\x0B")
        s=s.replace(b"\x10\x05\x00\xA0\x10\x00\x00\xC8\xA6\x00\x00\x00\x10\x0B",b"\x10\x05\x00\xA0\x10\x00\x00\xC1\xA6\x00\x00\x00\x10\x0B")
        s=s.replace(b"\x10\x05\x00\xA0\x10\x00\x00\xCA\xA8\x00\x00\x00\x10\x0B",b"\x10\x05\x00\xA0\x10\x00\x00\xC4\xA6\x00\x00\x00\x10\x0B")
        s=s.replace(b"\x10\x05\x00\xA0\x10\x00\x00\xCB\xA6\x00\x00\x00\x10\x0B",b"\x10\x05\x00\xA0\x10\x00\x00\xC4\xA6\x00\x00\x00\x10\x0B")
        s=s.replace(b"\x10\x05\x00\xA0\x10\x00\x00\xC8\xA8\x00\x00\x00\x10\x0B",b"\x10\x05\x00\xA0\x10\x00\x00\xC3\xA6\x00\x00\x00\x10\x0B")
        s=s.replace(b"\x10\x05\x00\xA0\x10\x00\x00\xC7\xAA\x00\x00\x00\x10\x0B",b"\x10\x05\x00\xA0\x10\x00\x00\xC1\xA6\x00\x00\x00\x10\x0B")
        s=s.replace(b"\x10\x05\x00\xA0\x10\x00\x00\xCD\xA6\x00\x00\x00\x10\x0B",b"\x10\x05\x00\xA0\x10\x00\x00\xC3\xA6\x00\x00\x00\x10\x0B")
    elif (file=="SG0_01_05.scx"): # Not Finished
        # Kurisu
        s=s.replace(b"\xFE\x28\x0A\xA0\x27\x14\x14\x00\xC2\x80\x00\x00\x00",b"\xFE\x28\x0A\xA0\x27\x14\x14\x00\xC9\x7E\x00\x00\x00")
        s=s.replace(b"\xDA\x00\x01\x11\x01\x01\x11\x02\x01\x0B\x01\x0C\x03",b"\xDC\x00\x01\x11\x01\x01\x11\x02\x01\x0B\x01\x0C\x03")
        s=s.replace(b"\xFE\x28\x0A\xA0\x27\x14\x14\x00\xCA\x7E\x00\x00\x00",b"\xFE\x28\x0A\xA0\x27\x14\x14\x00\xC5\x7E\x00\x00\x00")
        s=s.replace(b"\x00\x12\xA5\x08\x00\x00",b"\x00\x12\xA1\xC9\x00\x00")

    f=open(file,"wb")
    f.write(s)
    f.close()
